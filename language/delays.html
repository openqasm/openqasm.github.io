
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Circuit timing &#8212; OpenQASM Live Specification  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/colors.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pulse-level descriptions of gates and measurement" href="pulses.html" />
    <link rel="prev" title="Directives" href="directives.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="circuit-timing">
<h1>Circuit timing<a class="headerlink" href="#circuit-timing" title="Permalink to this headline">¶</a></h1>
<p>A key aspect of expressing code for quantum experiments is the ability
to control the timing of gates and pulses. Examples include
characterization of decoherence and crosstalk, dynamical decoupling,
dynamically corrected gates, and gate scheduling. This can be a
challenging task given the potential heterogeneity of calibrated gates
and their various durations. It is useful to specify gate timing and
parallelism in a way that is independent of the precise duration and
implementation of gates at the pulse-level description. In other words,
we want to provide the ability to capture <em>design intent</em> such as “space
these gates evenly to implement a higher-order echo decoupling sequence”
or “implement this gate as late as possible”.</p>
<section id="duration-and-stretch-types">
<span id="duration-and-stretch"></span><h2>Duration and stretch types<a class="headerlink" href="#duration-and-stretch-types" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">duration</span></code> type is used denote increments of time. Durations are positive real numbers
that are manipulated at compile time. Durations must be followed by time units which can be
any of the following:</p>
<ul class="simple">
<li><p>SI units of time: <code class="docutils literal notranslate"><span class="pre">ns,</span> <span class="pre">µs</span> <span class="pre">or</span> <span class="pre">us,</span> <span class="pre">ms,</span> <span class="pre">s</span></code></p></li>
<li><p>Backend-dependent unit, <code class="docutils literal notranslate"><span class="pre">dt</span></code>, equivalent to the duration of one waveform
sample on the backend</p></li>
</ul>
<p>Units can appear attached to the numerical value, or immediately following
separated only by blanks or tabs. <code class="docutils literal notranslate"><span class="pre">1000ms</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">1000</span> <span class="pre">ms</span></code>.</p>
<p>It is often useful to reference the duration of other parts of the
circuit. For example, we may want to delay a gate for twice the duration
of a particular sub-circuit, without knowing the exact value to which
that duration will resolve. Alternatively, we may want to calibrate a
gate using some pulses, and use its duration as a new <code class="docutils literal notranslate"><span class="pre">duration</span></code> in order to delay
other parts of the circuit. The <code class="docutils literal notranslate"><span class="pre">durationof()</span></code> intrinsic function can be used for this
type of referential timing.</p>
<p>Below are some examples of values of type <code class="docutils literal notranslate"><span class="pre">duration</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// fixed duration, in standard units</span>
<span class="n">duration</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">300</span><span class="n">ns</span><span class="p">;</span><span class="w"></span>
<span class="c1">// fixed duration, backend dependent</span>
<span class="n">duration</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="n">dt</span><span class="p">;</span><span class="w"></span>
<span class="c1">// fixed duration, referencing the duration of a calibrated gate</span>
<span class="n">duration</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">durationof</span><span class="p">({</span><span class="n">x</span><span class="w"> </span><span class="n">$3</span><span class="p">;});</span><span class="w"></span>
</pre></div>
</div>
<p>We further introduce a <code class="docutils literal notranslate"><span class="pre">stretch</span></code> type which is a sub-type of <code class="docutils literal notranslate"><span class="pre">duration</span></code>. Stretchable durations
have variable non-negative duration that are permitted to grow as necessary
to satisfy constraints. Stretch variables are resolved at compile time
into target-appropriate durations that satisfy a user’s specified design
intent.</p>
<p>Instructions whose duration are specified in this way become “stretchy”,
meaning they can extend beyond their “natural duration” to fill a span of
time. Stretchy <code class="docutils literal notranslate"><span class="pre">delay</span></code>’s are the most obvious use case, but this can be extended
to other instructions too, e.g. rotating a spectator qubit while another
gate is in progress. Similarly, a <code class="docutils literal notranslate"><span class="pre">gate</span></code> whose definition contains stretchy
delays will be perceived as a stretchy gate by other parts of the
program.</p>
<figure class="align-default" id="id2">
<span id="fig-alignment"></span><div class="figure-content" style="display: flex; gap: 2rem 0; flex-direction: row; justify-content: center; align-items: baseline; flex-wrap: wrap;">
<div class="figure-item" style="max-height: 10rem; width: 50%; display: flex; flex-direction: column;">
<img alt="../_images/d1.svg" src="../_images/d1.svg" /><p class="caption">
<span class="caption-number">
a</p>
</span>
</div>
<div class="figure-item" style="max-height: 10rem; width: 50%; display: flex; flex-direction: column;">
<img alt="../_images/d2.svg" src="../_images/d2.svg" /><p class="caption">
<span class="caption-number">
b</p>
</span>
</div>
</div>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Arbitrary alignment of gates in time using stretchy delays. a) left-justified
alignment b) alignment of a short gate at the 1/3 point of a longer gate.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>For example, in order to ensure a sequence of gates between two barriers
will be left-aligned (<a class="reference internal" href="#fig-alignment"><span class="std std-numref">Fig. 6</span></a>a),
whatever their actual durations may be, we can do the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">qubit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="n">barrier</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="n">cx</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="n">U</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="n">cx</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w"></span>
<span class="n">stretch</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="n">stretch</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="n">stretch</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w"></span>
<span class="n">barrier</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>We can further control the exact alignment by giving relative weights to
the stretchy delays (<a class="reference internal" href="#fig-alignment"><span class="std std-numref">Fig. 6</span></a>b):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">qubit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="n">stretch</span><span class="w"> </span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="n">barrier</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="n">cx</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">g</span><span class="p">];</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">];</span><span class="w"></span>
<span class="n">barrier</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The concepts of <code class="docutils literal notranslate"><span class="pre">box</span></code> (see <span class="xref std std-ref">Boxed expressions</span>) and <code class="docutils literal notranslate"><span class="pre">stretch</span></code> are inspired by the
concept of “boxes and glues” in the TeX language <span id="id1">[<a class="reference internal" href="../index.html#id50" title="Donald Ervin Knuth and Duane Bibby. The texbook. Volume 3. Addison-Wesley Reading, 1984.">KB84</a>]</span>. This similarity
is natural; TeX aims to resolve the spacing between characters in order
to typeset a page, and the size of characters depend on the backend
font. In OpenQASM we intend to resolve the timing of different
instructions in order to meet high-level design intents, while the true
duration of operations depend on the backend and compilation context.
There are however some key differences. Quantum operations can be
non-local, meaning the durations set on one qubit can have side effects on
other qubits. The definition of <code class="docutils literal notranslate"><span class="pre">duration</span></code>-type variables and ability to define
multi-qubit stretches is intended to alleviate potential problems from
these side effects. Also contrary to TeX, we prohibit overlapping gates.</p>
</section>
<section id="operations-on-durations">
<h2>Operations on durations<a class="headerlink" href="#operations-on-durations" title="Permalink to this headline">¶</a></h2>
<p>We can add/subtract two durations, or multiply or divide them by a constant, to get a new
duration. Division of two durations results in a machine-precision float
(see <a class="reference internal" href="types.html#divideduration"><span class="std std-ref">Converting duration to other types</span></a>). Negative durations are allowed, however
passing a negative duration to a <code class="docutils literal notranslate"><span class="pre">gate[duration]</span></code> or <code class="docutils literal notranslate"><span class="pre">box[duration]</span></code> expression will result in an error.
All operations on durations happen at compile time since ultimately all
durations, including stretches, will be resolved to constants.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">300</span><span class="n">ns</span><span class="p">;</span><span class="w"></span>
<span class="n">duration</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">durationof</span><span class="p">({</span><span class="n">x</span><span class="w"> </span><span class="n">$0</span><span class="p">;});</span><span class="w"></span>
<span class="n">stretch</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="c1">// stretchy duration with min=300ns</span>
<span class="n">stretch</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="c1">// stretchy duration with backtracking by up to half b</span>
<span class="n">stretch</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="delays-and-other-duration-based-instructions">
<h2>Delays (and other duration-based instructions)<a class="headerlink" href="#delays-and-other-duration-based-instructions" title="Permalink to this headline">¶</a></h2>
<p>OpenQASM and OpenPulse have a <code class="docutils literal notranslate"><span class="pre">delay</span></code> instruction, whose duration is defined by
a <code class="docutils literal notranslate"><span class="pre">duration</span></code>. If the duration passed to the delay contains stretch, it will become a
stretchy delay. We use square bracket notation to pass these duration
parameters, to distinguish them from regular parameters (the compiler
will resolve these square-bracket parameters when resolving timing).</p>
<p>Even though a <code class="docutils literal notranslate"><span class="pre">delay</span></code> instruction implements the identity operator in the ideal
case, it is intended to provide explicit timing. Therefore an explicit <code class="docutils literal notranslate"><span class="pre">delay</span></code>
instruction will prevent commutation of gates that would otherwise
commute. For example in
<a class="reference internal" href="#fig-delaycommute"><span class="std std-numref">Fig. 7</span></a>a , there will be an
implicit delay between the <code class="docutils literal notranslate"><span class="pre">cx</span></code> gates on qubit 0. However, the <code class="docutils literal notranslate"><span class="pre">rz</span></code> gate is
still free to commute on that qubit, because the delay is implicit. Once
the delay becomes explicit (perhaps at lower stages of compilation),
gate commutation is prohibited (Figure <a class="reference internal" href="#fig-delaycommute"><span class="std std-numref">Fig. 7</span></a>b).</p>
<figure class="align-default" id="id3">
<span id="fig-delaycommute"></span><div class="figure-content" style="display: flex; gap: 2rem 0; flex-direction: row; justify-content: center; align-items: baseline; flex-wrap: wrap;">
<div class="figure-item" style="max-height: 10rem; width: 50%; display: flex; flex-direction: column;">
<img alt="../_images/d3.svg" src="../_images/d3.svg" /><p class="caption">
<span class="caption-number">
a</p>
</span>
</div>
<div class="figure-item" style="max-height: 10rem; width: 50%; display: flex; flex-direction: column;">
<img alt="../_images/d4.svg" src="../_images/d4.svg" /><p class="caption">
<span class="caption-number">
b</p>
</span>
</div>
</div>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Implicit vs. explicit delay. a) An implicit delay exists on <span class="math notranslate nohighlight">\(q[0]\)</span>, but it
is not part of the circuit description. Thus this circuit does not care about
timing and the <span class="math notranslate nohighlight">\(RZ\)</span> gate is free to commute on the top wire. b) An explicit
delay is part of the circuit description. The timing is consistent and can
be resolved if and only if this delay is exactly the same duration as <span class="math notranslate nohighlight">\(RY\)</span> on
<span class="math notranslate nohighlight">\([1]\)</span>. The delay is like a barrier in that it prevents commutation on that
wire. However <span class="math notranslate nohighlight">\(RZ\)</span> can still commute before the <span class="math notranslate nohighlight">\(CNOT\)</span> if it has
duration <span class="math notranslate nohighlight">\(0\)</span>.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id4">
<span id="fig-dcg"></span><div class="figure-content" style="display: flex; gap: 2rem 0; flex-direction: row; justify-content: center; align-items: baseline; flex-wrap: wrap;">
<div class="figure-item" style="max-height: 10rem; width: 50%; display: flex; flex-direction: column;">
<img alt="../_images/d5.svg" src="../_images/d5.svg" /><p class="caption">
<span class="caption-number">
a</p>
</span>
</div>
<div class="figure-item" style="max-height: 10rem; width: 50%; display: flex; flex-direction: column;">
<img alt="../_images/d6.svg" src="../_images/d6.svg" /><p class="caption">
<span class="caption-number">
b</p>
</span>
</div>
</div>
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Dynamically corrected CNOT gate where the spectator has a rotary pulse. The
rotary gates are stretchy, and the design intent is to interleave a “winding”
and “unwinding” that is equal to the total duration of the CNOT. We do this
without knowledge of the CNOT duration, and the compiler resolves them to the
correct duration during lowering to the target backend.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id5">
<span id="fig-dd"></span><div class="figure-content" style="display: flex; gap: 2rem 0; flex-direction: row; justify-content: center; align-items: center; flex-wrap: wrap;">
<div class="figure-item" style="max-height: 10rem; width: 100%; display: flex; flex-direction: column;">
<img alt="../_images/d7.svg" src="../_images/d7.svg" /></div>
</div>
<figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text">Dynamical decoupling of a spectator qubit using finite-duration DD pulses.
The boxes are intentionally drawn to scale to give a sense of how finite gate
durations affect circuit timing. This design intent can be expressed by
defining a single stretch variable “equal” that corresponds to the distance
between equidistant gate centers. The other durations which correspond to
actual circuit delays are derived by simple arithmetic. Given a
target system with calibrated X and Y gates, the solution to the stretch
problem can be found.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Instructions other than delay can also have variable duration, if they
are explicitly defined as such. They can be called by passing a valid <code class="docutils literal notranslate"><span class="pre">duration</span></code> as
their duration. Consider for example a rotation called <code class="docutils literal notranslate"><span class="pre">rotary</span></code> that is applied
for the entire duration of some other gate.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">amp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* number */</span><span class="p">;</span><span class="w"></span>
<span class="n">stretch</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="n">rotary</span><span class="p">(</span><span class="n">amp</span><span class="p">)[</span><span class="mi">250</span><span class="n">ns</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w">   </span><span class="c1">// square brackets indicates duration</span>
<span class="n">rotary</span><span class="p">(</span><span class="n">amp</span><span class="p">)[</span><span class="n">a</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w">       </span><span class="c1">// a rotation that will stretch as needed</span>
</pre></div>
</div>
<p>A multi-qubit <code class="docutils literal notranslate"><span class="pre">delay</span></code> instruction is <em>not</em> equivalent to multiple single-qubit
<code class="docutils literal notranslate"><span class="pre">delay</span></code> instructions. Instead a multi-qubit delay acts as a synchronization
point on the qubits, where the delay begins from the latest non-idle
time across all qubits, and ends simultaneously across all qubits.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">cx</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="n">cx</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
<span class="c1">// delay for 200 samples starting from the end of the longest cx</span>
<span class="n">delay</span><span class="p">[</span><span class="mi">200</span><span class="n">dt</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">duration</span></code> can be composed of positive or negative durations, and of
positive stretches. After resolving the stretches, the instruction must end
up with non-negative duration.</p>
<p>For example, the code below inserts a dynamical decoupling sequence
where the *centers* of pulses are equidistant from each other. We
specify correct durations for the delays by using backtracking operations
to properly take into account the finite duration of each gate.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">stretch</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="n">stretch</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="n">duration</span><span class="w"> </span><span class="n">start_stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">durationof</span><span class="p">({</span><span class="n">x</span><span class="w"> </span><span class="n">$0</span><span class="p">;});</span><span class="w"></span>
<span class="n">duration</span><span class="w"> </span><span class="n">middle_stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">duration0</span><span class="p">({</span><span class="n">x</span><span class="w"> </span><span class="n">$0</span><span class="p">;})</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">durationof</span><span class="p">({</span><span class="n">y</span><span class="w"> </span><span class="n">$0</span><span class="p">;});</span><span class="w"></span>
<span class="n">duration</span><span class="w"> </span><span class="n">end_stretch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">durationof</span><span class="p">({</span><span class="n">y</span><span class="w"> </span><span class="n">$0</span><span class="p">;});</span><span class="w"></span>

<span class="n">delay</span><span class="p">[</span><span class="n">start_stretch</span><span class="p">]</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">end_stretch</span><span class="p">]</span><span class="w"> </span><span class="n">$0</span><span class="p">;</span><span class="w"></span>

<span class="n">cx</span><span class="w"> </span><span class="n">$2</span><span class="p">,</span><span class="w"> </span><span class="n">$3</span><span class="p">;</span><span class="w"></span>
<span class="n">delay</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="n">$1</span><span class="p">;</span><span class="w"></span>
<span class="n">cx</span><span class="w"> </span><span class="n">$1</span><span class="p">,</span><span class="w"> </span><span class="n">$2</span><span class="p">;</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="n">$3</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="boxed-expressions">
<h2>Boxed expressions<a class="headerlink" href="#boxed-expressions" title="Permalink to this headline">¶</a></h2>
<p>We introduce a <code class="docutils literal notranslate"><span class="pre">box</span></code> statement for scoping the timing of a particular part of the circuit.
A boxed subcircuit is different from a <code class="docutils literal notranslate"><span class="pre">gate</span></code> or <code class="docutils literal notranslate"><span class="pre">def</span></code> subroutine, in that it is merely
an enclosure to a piece of code within the larger scope which constains it. This can be used to
signal permissible logical-level optimizations to the compiler: optimizing operations within
a <code class="docutils literal notranslate"><span class="pre">box</span></code> definition is permitted, and optimizations that move operations from one side to
the other side of a box are permitted, but moving operations either into or out of the box as
part of an optimization is forbidden. The compiler can also infer a description of the
operation which a <code class="docutils literal notranslate"><span class="pre">box</span></code> definition is meant to realise, allowing it to re-order gates around
the box. For example, consider a dynamical decoupling sequence inserted in a part of the circuit:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">rx</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">π</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">[</span><span class="n">ddt</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">[</span><span class="n">ddt</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">[</span><span class="n">ddt</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">rx</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">π</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>By boxing the sequence, we create a box that implements the identity. The compiler is now free
to commute a gate past the box by knowing the unitary implemented by the box:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">rx</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">π</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">[</span><span class="n">ddt</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">[</span><span class="n">ddt</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">[</span><span class="n">ddt</span><span class="p">]</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The compiler can thus perform optimizations without interfering with the implmentation of the
dynamical decoupling sequence.</p>
<p>As with other operations, we may use square brakets to assign a duration to a box: this can be
used to put hard constraints on the execution of a particular sub-circuit by requiring it to
have the assigned duration. This can be useful in scenarios where the exact duration of a piece
of code is unknown (<em>e.g.</em>, if it is runtime dependent), but where it would be helpful to impose
a duration on it for the purpose of scheduling the larger circuit. For example, if the duration
of the parameterized gates <code class="docutils literal notranslate"><span class="pre">mygate1(a,</span> <span class="pre">b),</span> <span class="pre">mygate2(a,</span> <span class="pre">b)</span></code> depend on values of the variables
<code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> in a complex way, but an offline calculation has shown that the total will never
require more than 150ns for all valid combinations:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// some complicated circuit that gives runtime values to a, b</span>
<span class="n">box</span><span class="w"> </span><span class="p">[</span><span class="mi">150</span><span class="n">ns</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">delay</span><span class="p">[</span><span class="n">str1</span><span class="p">]</span><span class="w"> </span><span class="n">q1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Schedule as late as possible within the box</span>
<span class="w">    </span><span class="n">mygate1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">mygate2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">mygate1</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="barrier-instruction">
<h2>Barrier instruction<a class="headerlink" href="#barrier-instruction" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">barrier</span></code> instruction of OpenQASM 2 prevents commutation and gate reordering
on a set of qubits across its source line. The syntax is <code class="docutils literal notranslate"><span class="pre">barrier</span> <span class="pre">qregs|qubits;</span></code> and can be seen
in the following example</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">cx</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="n">h</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="n">h</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="n">barrier</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="n">h</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="n">cx</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="n">cx</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>This will prevent an attempt to combine the CNOT gates but will not
constrain the pair of <code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">a[0];</span></code> gates, which might be executed before or after the
barrier, or cancelled by a compiler.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">barrier</span></code> is similar to <code class="docutils literal notranslate"><span class="pre">delay[0]</span></code>. The main difference is that <code class="docutils literal notranslate"><span class="pre">delay</span></code> indicates a fully
scheduled series of instructions, whereas <code class="docutils literal notranslate"><span class="pre">barrier</span></code> implies an ordering constraint that will be
resolved by the compiler at a later stage.</p>
<p>A barrier can also be invoked without arguments, in which case the argument is assumed to be all
qubits.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">OpenQASM Live Specification</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="comments.html">Comments</a></li>
<li class="toctree-l2"><a class="reference internal" href="comments.html#version-string">Version string</a></li>
<li class="toctree-l2"><a class="reference internal" href="comments.html#included-files">Included files</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">Types and Casting</a></li>
<li class="toctree-l2"><a class="reference internal" href="gates.html">Gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="insts.html">Built-in quantum instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="classical.html">Classical instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="subroutines.html">Subroutines</a></li>
<li class="toctree-l2"><a class="reference internal" href="directives.html">Directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="directives.html#input-output">Input/output</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Circuit timing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#duration-and-stretch-types">Duration and stretch types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operations-on-durations">Operations on durations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#delays-and-other-duration-based-instructions">Delays (and other duration-based instructions)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boxed-expressions">Boxed expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#barrier-instruction">Barrier instruction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pulses.html">Pulse-level descriptions of gates and measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="openpulse.html">OpenPulse Grammar</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../grammar/index.html">OpenQasm 3.0 Grammar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Language</a><ul>
      <li>Previous: <a href="directives.html" title="previous chapter">Directives</a></li>
      <li>Next: <a href="pulses.html" title="next chapter">Pulse-level descriptions of gates and measurement</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017-2020, Andrew W. Cross, Lev S. Bishop, John A. Smolin, Jay M. Gambetta.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/language/delays.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>